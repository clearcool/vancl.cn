<?phpnamespace App\Http\Controllers\home;use Illuminate\Http\Request;use DB;use App\Http\Requests;use App\Http\Controllers\Controller;use Illuminate\Routing\Route;use Gregwar\Captcha\CaptchaBuilder;use Cache;use Session;class HomeController extends Controller{    /**     * 首页方法     * @param     * @return null     */    public function index()    {        return view('home.index');    }    /**     * 前台登录页面     * @return     */    public function getLogin()    {        return view('home.login');    }    /**     * 手机登录验证码     *     */    public function getCaptcha()    {        //生成验证码图片的Builder对象，配置相应属性        $builder = new CaptchaBuilder;        //可以设置图片宽高及字体        $builder->build($width = 100, $height = 40, $font = null);        //获取验证码的内容        $phrase = $builder->getPhrase();        //把内容存入session        Session::flash('milkcaptcha', $phrase);        //生成图片        header("Cache-Control: no-cache, must-revalidate");        header('Content-Type: image/jpeg');        $builder->output();    }    /**     * 前台登录信息     * @return     */    public function postLoginb()    {        echo '33';    }    /**     * 前台注册页面     * @return     */    public function getRegister()    {        return view('home.register');    }    /**     * 前台注册信息     * @return     */    public function postRegisterb(Request $request)    {        $user = $request->all();        dd($user);    }    /**     * 详情页方法     * @param     * @return     */    public function getDetails()    {        return view('home.details');    }    /**     * 头部列表     * @param     * @return     */    public function getHead()    {        return view('home.headlist');    }    /**     * 列表页方法     * @param     * @return     */    public function getList(Request $request)    {        //用户列表页        $id = $request->input('id');        if(!empty("a"))        {            // DB::connection()->enableQueryLog();            $shop = DB::table('shop as s')                ->join('shop_comment as sc','s.s_id','=','sc.s_id')                ->where('s.st_id',$id)                ->paginate(2);            // dd(DB::getQueryLog());        }        switch($request->input('a')){            case "default":                $shop = DB::table('shop as s')                    ->join('shop_comment as sc','s.s_id','=','sc.s_id')                    ->where('s.st_id',$id)                    ->paginate(2);                break;            case "sole":                $shop = DB::table('shop as s')                    ->join('shop_comment as sc','s.s_id','=','sc.s_id')                    ->where('s.st_id',$id)                    ->orderBy('Sales', 'desc')                    ->paginate(2);                break;            case "praise":                // DB::connection()->enableQueryLog();                $shop = DB::table('shop as s')                    ->join('shop_comment as sc','s.s_id','=','sc.s_id')                    ->where('s.st_id',$id)                    ->orderby('sc.star','desc')                    ->paginate(2);                // dd(DB::getQueryLog());                break;            case "newtime":                $shop = DB::table('shop as s')                    ->join('shop_comment as sc','s.s_id','=','sc.s_id')                    ->where('s.st_id',$id)                    ->orderBy('uptime', 'desc')                    ->paginate(2);                break;        }        //商品库存        $shopsales = DB::table('shop')            ->where('st_id',$id)            ->value('Sales');        //类别名查询        $titletype=DB::table('shop_type')            ->where('st_id',$id)            ->value('stname');        //获取所有的请求参数        $all = $request->all();        //解析模板        return view('home.list',['id'=>$id,'shopsales'=>$shopsales,'titletype'=>$titletype,'shop'=>$shop ,'all'=>$all]);    }   }